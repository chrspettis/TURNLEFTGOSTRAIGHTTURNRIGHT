<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TURN-LEFT GO-STRAIGHT TURN-RIGHT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #07183c, #2a0d28);
      color: #fefefe;
    }
    h1 {
      font-size: 28px;
      font-weight: bold;
      margin: 20px;
      color: #c39d55;
    }
    .sub {
      margin: 0 20px 20px;
      font-size: 16px;
      color: rgba(207,203,193,.85);
    }
    .wrap {
      padding: 20px;
    }
    .grid {
      display: grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 20px;
    }
    .panel {
      background: rgba(2,6,23,0.35);
      border: 1px solid rgba(195,157,85,0.4);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 18px 50px rgba(0,0,0,0.45);
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 10px;
    }
    .stat {
      padding: 10px;
      border-radius: 10px;
      background: rgba(2,6,23,0.35);
      border: 1px solid rgba(195,157,85,0.22);
    }
    .label {
      font-size: 12px;
      color: rgba(207,203,193,0.85);
    }
    .value {
      font-size: 16px;
      color: #fafbfd;
    }
    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px 0;
    }
    button {
      padding: 14px;
      font-weight: bold;
      border-radius: 10px;
      border: 1px solid rgba(207,203,193,0.22);
      background: linear-gradient(to bottom, rgba(195,157,85,0.98), rgba(141,102,54,0.98));
      color: #07183c;
      cursor: pointer;
      min-width: 120px;
    }
    button:hover {
      filter: brightness(1.05);
    }
    .lists {
      margin-top: 20px;
    }
    .lists h3 {
      margin: 10px 0;
      color: #fefefe;
    }
    .pillRow {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .pill {
      background: rgba(42,13,40,0.28);
      border: 1px solid rgba(195,157,85,0.18);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 13px;
    }
    .log {
      margin-top: 16px;
      padding: 12px;
      border: 1px solid rgba(195,157,85,0.22);
      border-radius: 10px;
      background: rgba(2,6,23,0.22);
      font-size: 14px;
      line-height: 1.5;
      max-height: 180px;
      overflow-y: auto;
    }
    .mapGrid {
      display: grid;
      grid-template-columns: repeat(11, 1fr);
      gap: 6px;
    }
    .cell {
      width: 30px;
      aspect-ratio: 1;
      border-radius: 8px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(195,157,85,0.10);
    }
    .cell.visited {
      background: rgba(42,13,40,0.18);
      border-color: rgba(195,157,85,0.16);
    }
    .cell.current {
      outline: 2px solid rgba(195,157,85,0.92);
    }
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(2,6,23,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .modal {
      background: linear-gradient(180deg, rgba(7,24,60,.95), rgba(42,13,40,.92));
      border: 1px solid rgba(195,157,85,.40);
      border-radius: 12px;
      padding: 20px;
      width: min(90vw, 720px);
      color: #fafbfd;
      box-shadow: 0 20px 60px rgba(0,0,0,0.55);
    }
    .modal h2 {
      margin-top: 0;
      color: #c39d55;
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1>TURN-LEFT GO-STRAIGHT TURN-RIGHT</h1>
  <p class="sub">Students preview routes and choose intentionally.</p>
  <div class="grid">
    <div class="panel">
      <div class="stats">
        <div class="stat"><div class="label">Position</div><div class="value" id="pos">0, 0</div></div>
        <div class="stat"><div class="label">Facing</div><div class="value" id="facing">North</div></div>
        <div class="stat"><div class="label">Moves</div><div class="value" id="moves">0</div></div>
        <div class="stat"><div class="label">Auto-Save</div><div class="value">On</div></div>
      </div>
      <div class="buttons">
        <button id="btnLeft">TURN-LEFT</button>
        <button id="btnStraight">GO-STRAIGHT</button>
        <button id="btnRight">TURN-RIGHT</button>
      </div>
      <div class="buttons">
        <button id="btnNew">New Game</button>
        <button id="btnClearJournal">Clear Journal</button>
        <button id="btnEraseSave">Erase Save</button>
      </div>
      <div class="lists">
        <h3>Clues</h3><div class="pillRow" id="invRow"></div>
        <h3>Contacts</h3><div class="pillRow" id="peopleRow"></div>
        <h3>Landmarks</h3><div class="pillRow" id="placesRow"></div>
      </div>
      <div class="log" id="log"></div>
    </div>
    <div class="panel">
      <h3>Map</h3>
      <div class="mapGrid" id="mapGrid"></div>
    </div>
  </div>
</div>

<div class="modal-backdrop" id="backdrop">
  <div class="modal">
    <h2 id="modalMeta"></h2>
    <p id="travelText"></p>
    <p class="poi-name" id="poiName" style="font-weight:bold; color:#c39d55;"></p>
    <p id="poiDesc"></p>
    <p id="promptNext" style="margin-top:20px; font-weight:bold;"></p>
    <div class="buttons" style="margin-top:16px;"><button id="btnContinue">Close</button></div>
  </div>
</div>
<script>
/* JS CODE CONTINUES BELOW THIS LINE… */
</script>
</body>
</html>
<script>
const SAVE_KEY = "TLGSTL_SAVE";
const POIS = {
  places: [
    { name: "Clocktower Plaza", desc: "The chime is late by one beat. Every time." },
    { name: "Willowbend Reading Nook", desc: "Dusty pages flutter even without wind." },
    { name: "Harborstone Ferry Ramp", desc: "The ramp dips into grass, not water." },
    { name: "Evergreen Coffee Roasters", desc: "Always smells freshly brewed, even at night." },
    { name: "Underground Stage", desc: "No lights. Just footprints in chalk." }
  ],
  people: [
    { name: "The Street Artist", desc: "Watches your hands instead of your face." },
    { name: "The Archivist", desc: "Knows what you’re looking for before you do." },
    { name: "The Night Courier", desc: "Delivers memories, not mail." },
    { name: "The Quiet Neighbor", desc: "Never seen leaving, never heard arriving." },
    { name: "The Open-Shop Owner", desc: "Greets you like you’re late." },
    { name: "The Mechanic", desc: "Fixes things that aren't broken." },
    { name: "The Lost Tourist", desc: "They ask for directions without a map." }
  ],
  objects: [
    { name: "Pocket Compass", desc: "Points to where you felt safe last." },
    { name: "Map Fragment", desc: "Curled edge. Ink runs like it was wept on." },
    { name: "Polaroid Photo", desc: "A place you haven’t been… yet." },
    { name: "Rusty Key", desc: "Labeled: Not the Front Door." },
    { name: "Brass Token", desc: "Worn smooth by anxious fingers." },
    { name: "Chalk Marker", desc: "Uncap it and your hand shakes." },
    { name: "Bent Street Sign", desc: "Still legible, just not in your language." }
  ]
};

let state = {
  seed: Date.now() >>> 0,
  x: 0,
  y: 0,
  facing: 0,
  moves: 0,
  visited: new Set(["0,0"]),
  discovered: new Map(),
  inventory: new Set(),
  metPeople: new Set(),
  foundPlaces: new Set(),
  story: { chapter: 0, journal: [] }
};

function stepForwardFrom(x, y, facing) {
  return facing === 0 ? { x, y: y + 1 }
       : facing === 1 ? { x: x + 1, y }
       : facing === 2 ? { x, y: y - 1 }
       : { x: x - 1, y };
}

function turn(delta, facing) {
  return (facing + delta + 4) % 4;
}

function computePOI(x, y, seed) {
  const key = (x * 73856093) ^ (y * 19349663) ^ seed;
  const r = Math.abs(key);
  const types = ["places", "objects", "people"];
  const t = types[r % 3];
  const list = POIS[t];
  const i = r % list.length;
  return { ...list[i], type: t };
}

function pickPOI(x, y) {
  const key = `${x},${y}`;
  if (!state.discovered.has(key)) {
    state.discovered.set(key, computePOI(x, y, state.seed));
  }
  return {
    poi: state.discovered.get(key),
    isNewTile: !state.visited.has(key)
  };
}

function travelNarration(choice, steps, poi, isNewTile) {
  const lead = poi.type === "places" ? "front steps of the"
             : poi.type === "people" ? "corner where you spot"
             : "spot where you notice";
  return `You walked ${steps} steps and arrived at the ${lead} ${poi.name}.`;
}

function journalEntry(msg) {
  state.story.journal.push(msg);
  writeLog(msg);
}

function writeLog(msg, muted = false) {
  const log = document.getElementById("log");
  const p = document.createElement("p");
  p.textContent = msg;
  if (muted) p.classList.add("muted");
  log.appendChild(p);
  log.scrollTop = log.scrollHeight;
}

function showModal(meta, text, poi) {
  document.getElementById("modalMeta").textContent = meta;
  document.getElementById("travelText").textContent = text;
  document.getElementById("poiName").textContent = poi.name;
  document.getElementById("poiDesc").textContent = poi.desc;
  document.getElementById("backdrop").style.display = "flex";
}

function hideModal() {
  document.getElementById("backdrop").style.display = "none";
}

function chooseDirection(choice) {
  if (choice === "LEFT") state.facing = turn(-1, state.facing);
  if (choice === "RIGHT") state.facing = turn(1, state.facing);
  const next = stepForwardFrom(state.x, state.y, state.facing);
  state.x = next.x;
  state.y = next.y;
  state.moves++;
  const posKey = `${state.x},${state.y}`;
  const { poi: rawPOI, isNewTile } = pickPOI(state.x, state.y);
  const poi = rawPOI;
  state.visited.add(posKey);

  if (isNewTile) {
    if (poi.type === "objects") state.inventory.add(poi.name);
    if (poi.type === "people") state.metPeople.add(poi.name);
    if (poi.type === "places") state.foundPlaces.add(poi.name);
    syncLists();
  }

  const steps = state.moves;
  const text = travelNarration(choice, steps, poi, isNewTile);
  journalEntry(text);
  syncAll();
  saveGame();
  showModal(`Moved ${choice}`, text, poi);
}
</script>
<script>
function syncLists() {
  const invRow = document.getElementById("invRow");
  const peopleRow = document.getElementById("peopleRow");
  const placesRow = document.getElementById("placesRow");

  invRow.innerHTML = "";
  peopleRow.innerHTML = "";
  placesRow.innerHTML = "";

  if (state.inventory.size === 0) invRow.innerHTML = "<span class='pill'>None yet</span>";
  else [...state.inventory].forEach(name => {
    const el = document.createElement("span");
    el.className = "pill";
    el.textContent = name;
    invRow.appendChild(el);
  });

  if (state.metPeople.size === 0) peopleRow.innerHTML = "<span class='pill'>None yet</span>";
  else [...state.metPeople].forEach(name => {
    const el = document.createElement("span");
    el.className = "pill";
    el.textContent = name;
    peopleRow.appendChild(el);
  });

  if (state.foundPlaces.size === 0) placesRow.innerHTML = "<span class='pill'>None yet</span>";
  else [...state.foundPlaces].forEach(name => {
    const el = document.createElement("span");
    el.className = "pill";
    el.textContent = name;
    placesRow.appendChild(el);
  });
}

function renderMap() {
  const g = document.getElementById("mapGrid");
  g.innerHTML = "";
  for (let y = 5; y >= -5; y--) {
    for (let x = -5; x <= 5; x++) {
      const c = document.createElement("div");
      c.className = "cell";
      const k = `${state.x + x},${state.y + y}`;
      if (state.visited.has(k)) c.classList.add("visited");
      if (x === 0 && y === 0) c.classList.add("current");
      g.appendChild(c);
    }  }
}

function syncAll() {
  document.getElementById("pos").textContent = `${state.x}, ${state.y}`;
  document.getElementById("facing").textContent = ["North", "East", "South", "West"][state.facing];
  document.getElementById("moves").textContent = `${state.moves}`;
  renderMap();
  syncLists();
}

function saveGame() {
  try {
    localStorage.setItem(SAVE_KEY, JSON.stringify({
      ...state,
      visited: [...state.visited],
      inventory: [...state.inventory],
      metPeople: [...state.metPeople],
      foundPlaces: [...state.foundPlaces],
      discovered: [...state.discovered.entries()]
    }));
  } catch {}
}

function eraseSave() {
  localStorage.removeItem(SAVE_KEY);
}

function loadGameIfPresent() {
  const raw = localStorage.getItem(SAVE_KEY);
  if (!raw) return false;
  try {
    const o = JSON.parse(raw);
    state = {
      ...o,
      visited: new Set(o.visited),
      inventory: new Set(o.inventory),
      metPeople: new Set(o.metPeople),
      foundPlaces: new Set(o.foundPlaces),
      discovered: new Map(o.discovered)
    };
    return true;
  } catch {
    return false;
  }
}

function resetGame() {
  state = {
    seed: Date.now() >>> 0,
    x: 0,
    y: 0,
    facing: 0,
    moves: 0,
    visited: new Set(["0,0"]),
    discovered: new Map(),
    inventory: new Set(),
    metPeople: new Set(),
    foundPlaces: new Set(),
    story: { chapter: 0, journal: [] }
  };
  document.getElementById("log").innerHTML = "";
  syncAll();
  saveGame();
}

document.getElementById("btnLeft").onclick = () => chooseDirection("LEFT");
document.getElementById("btnStraight").onclick = () => chooseDirection("STRAIGHT");
document.getElementById("btnRight").onclick = () => chooseDirection("RIGHT");
document.getElementById("btnNew").onclick = () => resetGame();
document.getElementById("btnClearJournal").onclick = () => {
  state.story.journal = [];
  document.getElementById("log").innerHTML = "";
  writeLog("Journal cleared.", true);
};
document.getElementById("btnEraseSave").onclick = () => {
  eraseSave();
  writeLog("Saved game erased.", true);
};
document.getElementById("btnContinue").onclick = hideModal;

(function boot() {
  if (!loadGameIfPresent()) resetGame();
  else syncAll();
})();
</script>
</body>
</html>
